<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment and News Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #2b2843;
        }
        h1 {
            text-align: center;
            color: white;
        }
        h4 {
            text-align: center;
            color: white;
        }
        h5 {
            text-align: center;
            color: white;
        }

        #form-container {
            max-width: 50%;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        textarea, input {
            width: 90%;
            margin-bottom: 10px;
            padding: 10px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #result-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        #sentiment-result, #sarcasm-result {
            padding: 10px;
            border-radius: 5px;
            width: 48%;
        }
        #sentiment-result {
            background-color: #e9ecef;
        }
        #sarcasm-result {
            background-color: #ffcccc;
            border: 2px solid red;
            display: none; /* Hidden by default, only show if sarcasm is detected */
        }
        #sentiment-result-main, #sarcasm-result-main {
            padding: 10px;
            border-radius: 5px;
            width: 48%;
        }
        #sentiment-result-main {
            background-color: #e9ecef;
        }
        #sarcasm-result-main {
            background-color: #ffcccc;
            border: 2px solid red;
            display: none; /* Hidden by default, only show if sarcasm is detected */
        }
        #sentiment-result-up, #sarcasm-result-up {
            padding: 10px;
            border-radius: 5px;
            width: 48%;
        }
        #sentiment-result-up {
            background-color: #e9ecef;
        }
        #sarcasm-result-up {
            background-color: #ffcccc;
            border: 2px solid red;
            display: none; /* Hidden by default, only show if sarcasm is detected */
        }
        #article{
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        #news-results {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Sentiment Analysis</h1> 
    
    <h4>Use this application to assess the semtiment (positive, negative, or neutral) of any text. You can search for recent Google News headlines for a given topic or company, input your own text, or upload a file. We also flag potential sarcasm, give a confidence score, and provide key words that influenced the analysis.</h4>
    <h5>Created at the 2024 Innovate with Deutsche Bank Hackathon by Ellie Burton, Meredith Dada, Kenny Howard, and Jaylan Hunter. Thank you Deutsche Bank Cary DTI for hosting us!</h5>

    <div id="form-container">
        <!-- Search bar for company news -->
        <input type="text" id="companyInput" placeholder="Search for company news..." />
        <button id="searchNewsBtn">Search News</button>

        <!-- Container for news search results -->
        <div id="news-results"></div>

        <textarea id="inputText" placeholder="Enter text to analyze..."></textarea>
        <button id="analyzeBtn">Analyze Text</button>

        <!-- Container for sentiment and sarcasm results -->
        <div id="result-container">
            <div id="sentiment-result-main"></div>
            <div id="sarcasm-result-main"></div>
        </div>

        <!-- area to upload a file-->
        <div id="upload-doc">
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="fileInput" name="file" accept=".txt,.pdf" />
                <button type="submit" id="uploadBtn">Upload Document</button>
            </form>
            <div id="upload-result">
                <div id="sentiment-result-up"></div>
                <div id="sarcasm-result-up"></div>
            </div>
        </div>
    </div>

    <script>
        // dealing with file upload
        document.getElementById("uploadForm").addEventListener("submit", function (event) {
            console.log("Uploading file...");
    event.preventDefault(); // Prevent form from submitting normally
    const formData = new FormData();
    const fileInput = document.getElementById("fileInput").files[0];
    if (!fileInput) {
        alert("Please select a file to upload.");
        return;
    }

    formData.append("file", fileInput);

    fetch('/upload', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        //get div 
        let uploadResult = document.getElementById("upload-result");
        let sentimentDiv = document.getElementById("sentiment-result-up");
        let sarcasmResultDiv = document.getElementById("sarcasm-result-up");
    
        console.log("Upload response:", data);
        if (data.error) {
            uploadResult.innerText = "Error: " + data.error;
        } else {
            sentimentDiv.innerHTML = `
                        <strong>Sentiment:</strong> ${data.sentiment.label}</br>
                        <strong>Confidence:</strong> ${(data.sentiment.score * 100).toFixed(2)}%<br>
                    `;

                    // If sarcasm is detected, display the sarcasm result in the red box
                    if (data.sarcasm.is_sarcastic) {
                        const sarcasmResultDiv = document.getElementById(`sarcasm-result`);
                        sarcasmResultDiv.innerHTML = `
                            <strong>Warning: Possible Sarcasm Detected!</strong><br>
                        `;
                        sarcasmResultDiv.style.display = 'block';  // Show the sarcasm box
                    } else {
                        document.getElementById(`sarcasm-result-up`).style.display = 'none';  // Hide sarcasm box if not detected
                    }
            console.log(data.message);
        }
    })
    .catch(error => {
        document.getElementById("upload-result").innerText = "An error occurred: " + error;
    });
});



        // Function to fetch news headlines from Flask API
        function fetchNews(company) {
            let i = 0;
            const newsResults = document.getElementById("news-results");
            newsResults.innerHTML = '';  // Clear previous results
            fetch('/search_news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ company })
            })
            .then(response => response.json())
            .then(data => {

                // Log data for debugging
                console.log("News Data:", data);

                // Display each headline
                if (data.length) {
                    data.forEach(article => {
                        let articleDiv = document.createElement("div");
                        articleDiv.id = `article`;
                        articleDiv.innerHTML = `
                            <h3>${article.title}</h3>
                            <a href="${article.link}" target="_blank">Read more</a></br>
                        `;
                        //make sentiment-analysis div inside articleDiv
                        let sentimentDiv = document.createElement("div");
                        sentimentDiv.id = `sentiment-result`;
                        sentimentDiv.innerHTML = `Sentiment`;
                        articleDiv.appendChild(sentimentDiv);

                        let sarcasmDiv = document.createElement("div");
                        sarcasmDiv.id = `sarcasm-result`;
                        sarcasmDiv.innerHTML = `Sarcasm`;
                        articleDiv.appendChild(sarcasmDiv);

                        newsResults.appendChild(articleDiv);


                        fetch('/analyze_text', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: article.title })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
condole.log("Error occurred.")                } else {
                    // Display sentiment analysis result
                    sentimentDiv.innerHTML = `
                        <strong>Sentiment:</strong> ${data.sentiment.label}</br>
                        <strong>Confidence:</strong> ${(data.sentiment.score * 100).toFixed(2)}%<br>
                    `;

                    // If sarcasm is detected, display the sarcasm result in the red box
                    if (data.sarcasm.is_sarcastic) {
                        const sarcasmResultDiv = document.getElementById(`sarcasm-result`);
                        sarcasmResultDiv.innerHTML = `
                            <strong>Warning: Possible Sarcasm Detected!</strong><br>
                        `;
                        sarcasmResultDiv.style.display = 'block';  // Show the sarcasm box
                    } else {
                        document.getElementById(`sarcasm-result`).style.display = 'none';  // Hide sarcasm box if not detected
                    }
                    newsResults.appendChild(articleDiv);
                    i++;

                }
            })
                   });
                } else {
                    newsResults.innerHTML = "No news results found.";
                }
            })
            .catch(error => {
                console.error("Error fetching news:", error);
                document.getElementById("news-results").innerText = "Error fetching news: " + error;
            });
        }

        // Event listener for the news search button
        document.getElementById("searchNewsBtn").addEventListener("click", function() {
            const company = document.getElementById("companyInput").value;
            if (!company) {
                alert("Please enter a company name.");
                return;
            }
            fetchNews(company);
        });

        // Existing sentiment and sarcasm detection logic
        document.getElementById("analyzeBtn").addEventListener("click", function() {
            const inputText = document.getElementById("inputText").value;

            if (!inputText) {
                alert("Please enter some text.");
                return;
            }

            // Send POST request to /analyze_text
            fetch('/analyze_text', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: inputText })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById("sentiment-result-main").innerText = "Error: " + data.error;
                } else {
                    // Display sentiment analysis result
                    document.getElementById("sentiment-result-main").innerHTML = `
                        <strong>Sentiment:</strong> ${data.sentiment.label}</br>
                        Confidence: ${(data.sentiment.score * 100).toFixed(2)}%<br>
                    `;

                    // If sarcasm is detected, display the sarcasm result in the red box
                    if (data.sarcasm.is_sarcastic) {
                        const sarcasmResultDiv = document.getElementById("sarcasm-result-main");
                        sarcasmResultDiv.innerHTML = `
                            <strong>Warning: Possible Sarcasm Detected!</strong><br>
                        `;
                        sarcasmResultDiv.style.display = 'block';  // Show the sarcasm box
                    } else {
                        document.getElementById("sarcasm-result-main").style.display = 'none';  // Hide sarcasm box if not detected
                    }
                }
            })
            .catch(error => {
                document.getElementById("sentiment-result-main").innerText = "An error occurred: " + error;
            });
        });
    </script>

</body>
</html>
